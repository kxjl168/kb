<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kxjl.admin.persistence.adapter.dao.KgEditDirTreeMapperAdapter">
<!--     <resultMap id="BaseResultMap"
               type="com.kxjl.admin.persistence.entity.KgEditDirTree"
               extends="com.kxjl.admin.persistence.dao.KgEditDirTreeMapper.BaseResultMap">
    </resultMap>
     在此编写自己的sql, 生成的sql文件不需要编辑

    <select id="selectByCondition" parameterType="com.kxjl.admin.persistence.entity.KgEditDirTree" resultMap="BaseResultMap">

    </select>
     -->
  

	<select id="selectList"  databaseId="mysql" 
		parameterType="com.kxjl.admin.persistence.entity.KgEditDirTree"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Jun 08 
			11:51:06 CST 2020. -->
		select
		c.*,p.dir_name parDirName,
		g.subGroupNames subNames,g.subGroupIds subIds
		from
		KG_EDIT_DIR_TREE
		c

		left join (

				select c.id,group_concat(kp.name order by kp.id) subGroupNames,
		group_concat(kp.id order by kp.id) subGroupIds
		FROM
		<include refid="selectAllClassTable" />
		c
		left join KG_OBJECT_SUB_GROUP op on c.id=op.obj_id
		left join   	<include refid="selectAllSubTable" />  kp on op.sub_group_id=kp.id
		group by c.id
		
		

		) g on c.id=g.id
		left join
		<include refid="selectAllClassTable" />
		p on p.id=c.par_dir_id



		where 1=1 and c.deleted='0'

		<if test=" dirName != null and dirName !='' ">

			<if test=" fullNameQuery != null and fullNameQuery !='' ">
				AND c.DIR_Name = #{dirName}
			</if>

			<if test=" fullNameQuery == null or fullNameQuery =='' ">
				<bind name="dirName" value="'%' + dirName + '%'" />
				AND c.DIR_Name LIKE #{dirName}
			</if>




		</if>


		<if test=" remark != null and remark !='' ">
			<bind name="remark" value="'%' + remark + '%'" />
			AND c.remark like #{remark}

		</if>



		<if test=" id != null and id !='' ">

			AND c.id = #{id}

		</if>
		
		<if test="parDirId != null and parDirId !='' ">
			and c.par_Dir_Id=#{parDirId}
		</if>



		order by c.CREATED_TIME DESC

	</select>

</mapper>