<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kxjl.admin.persistence.adapter.dao.KgPropertyMapperAdapter">
    <resultMap id="BaseResultMap"
               type="com.kxjl.admin.persistence.entity.KgProperty"
               extends="com.kxjl.admin.persistence.dao.KgPropertyMapper.BaseResultMap">
    </resultMap>
     <!--在此编写自己的sql, 生成的sql文件不需要编辑，分开管理-->

<select id="selectByName"
		parameterType="com.kxjl.admin.persistence.entity.KgProperty"
		resultMap="BaseResultMap">
		select
		c.*
		from KG_PROPERTY c
	

		where 1=1 and c.deleted='0'

		<if test="name != null and name!='' ">

			AND c.NAME= #{name}

		</if>

<if test="_databaseId =='oracle' " >
			<![CDATA[ and  rownum<=1 ]]> 
		</if>


	
	order by c.CREATED_TIME DESC
	
	<if test="_databaseId =='mysql' " >
		<![CDATA[ 
		limit 1 
		]]>
		</if>
	</select>

<select id="selectList"
		parameterType="com.kxjl.admin.persistence.entity.KgProperty"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Jun 08 
			11:51:06 CST 2020. -->
		select * from (
		select
		    c.ID,  c.VERSION_ID,  c.NAME,  c.DATA_TYPE_RULE,  c.EQUIVALENCE,  c.REMARK,  c.ENABLED,  c.DELETED,  c.CREATED_USER, 
     c.CREATED_TIME,  c.UPDATED_USER,  c.UPDATED_TIME
		from KG_PROPERTY c
		<if test="curUser != null and curUser!='' ">
		union
		(
		select      c.ID,  c.VERSION_ID,  c.NAME,  c.DATA_TYPE_RULE,  c.EQUIVALENCE,  c.REMARK,  c.ENABLED,  c.DELETED,  c.CREATED_USER, 
     c.CREATED_TIME,  c.UPDATED_USER,  c.UPDATED_TIME from 
		KG_EDIT_PROPERTY c
		left join kg_edit_data e on c.id=e.edit_data_id
		where 1=1 and e.edit_user=#{curUser}
		and e.edit_action='1'
		and e.audit_state in ('1','2') 
		)
		</if>
		) c
		
		
		where 1=1 and c.deleted='0'
		
		<if test="name != null and name!='' ">
			<bind name="name" value="'%' + name + '%'" />
			AND c.NAME LIKE #{name}

		</if>
		
		<!-- <if test="clsId != null and clsId !='' ">
			AND c.CLS_ID = #{clsId}
		</if> -->
		
		order by    c.CREATED_TIME DESC 
		
		</select>
		
	
      
		
</mapper>