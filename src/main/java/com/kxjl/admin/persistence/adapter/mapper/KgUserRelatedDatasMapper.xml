<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.kxjl.admin.persistence.adapter.dao.KgUserRelatedDatasMapperAdapter">
	<resultMap id="BaseResultMap"
		type="com.kxjl.admin.persistence.entity.KgUserRelatedDatas"
		extends="com.kxjl.admin.persistence.dao.KgUserRelatedDatasMapper.BaseResultMap">
	</resultMap>
	<!--在此编写自己的sql, 生成的sql文件不需要编辑 -->

	<select id="selectByCondition"
		parameterType="com.kxjl.admin.persistence.entity.KgUserRelatedDatas"
		resultMap="BaseResultMap">

	</select>

	<select id="selectRelationList"
		parameterType="com.kxjl.admin.persistence.entity.KgUserRelatedDatas"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Jun 08 
			11:51:06 CST 2020. -->


		select * from (
		SELECT
		data_id,dataname,max(rownum2) rownum2
		FROM
		(

		<if test="_databaseId =='oracle' ">




			SELECT
			c.data_id,
			r. NAME dataName,TO_NUMBER(c.CREATED_TIME -
			TO_DATE('1970-01-01 08:00:00', 'YYYY-MM-DD HH24:MI:SS')) * 24 * 60 * 60 * 1000 rownum2
			FROM
			KG_USER_RELATED_DATAS c
			LEFT JOIN KG_RELATION r ON c.DATA_ID = r. ID
			WHERE
			1 = 1 and r.deleted='0'
		</if>


		<if test="_databaseId =='mysql' ">



			SELECT
			c.data_id,
			r. NAME dataName,UNIX_TIMESTAMP(c.CREATED_TIME) rownum2
			FROM
			KG_USER_RELATED_DATAS c
			LEFT JOIN KG_RELATION r ON c.DATA_ID = r. ID
			WHERE
			1 = 1 and r.deleted='0'

		</if>



		<if test="userId != null and userId !='' ">

			AND c.user_Id= #{userId}

		</if>


		<if test="dataType != null and dataType !='' ">

			AND c.data_Type= #{dataType}

		</if>
		order by c.CREATED_TIME DESC
		) t group by data_id,dataname
		) a order by rownum2 desc




	</select>


</mapper>